[toc]

# 索引

## 概述

> **索引(index):**
> 	是帮助 MySQL *高效获取数据*的数据结构(有序)。

### 索引的特点

| 优点                                                         | 缺点                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 提高数据检索的效率，降低数据库的 IO 成本。                   | 索引列也要占用空间。                                         |
| 通过索引列对数据进行排序，降低数据排序的成本，降低 CPU 的消耗。 | 索引极大地提高了查询的效率，同时也降低了更新表的速度。<br />如: 对表进行 INSERT、UPDATE、DELETE 时，效率降低。 |

## 索引的结构

### 概述

> ​	MySQL 的索引是在存储引擎层实现的，不同的存储引擎有不同的索引结构。
>
> ​	主要包含以下几种：

| 索引结构            | 说明                                                         |
| ------------------- | ------------------------------------------------------------ |
| B+Tree 索引         | 最常见的索引类型，大部分引擎都支持 B+ 树索引。               |
| Hash 索引           | 底层数据结构是用哈希表实现的，只有精确匹配索引列的查询才有效, 不支持范围查询。 |
| R-tree(空间索引）   | 空间索引是 MyISAM 引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少。 |
| Full-text(全文索引) | 是一种通过建立倒排索引,快速匹配文档的方式。类似于`Lucene, Solr, ES`。 |

### 不同的存储引擎支持的索引结构

> 注意：
> 	我们平常所说的索引，如果没有特别指明，都是指 B+ 树结构组织的索引。

| 索引                | InnoDB           | MyISAM | Memory |
| ------------------- | ---------------- | ------ | ------ |
| B+Tree 索引         | 支持             | 支持   | 支持   |
| Hash 索引           | 不支持           | 不支持 | 支持   |
| R-tree(空间索引）   | 不支持           | 支持   | 不支持 |
| Full-text(全文索引) | 5.6 版本之后支持 | 支持   | 不支持 |

### 为什么 InnoDB 存储引擎采用 B+Tree 索引结构？

1. 相对于二叉树，B+Tree 的层级更少。
2. 对于 B-Tree，不论是叶子节点，还是非叶子节点，都会保存数据。
   这样导致一页中存储的键值减少，指针跟着减少。
   要同样保存大量数据，只能增加树的高度，导致性能降低。
3. 相对 Hash 索引，B+tree 支持范围匹配及排序操作。

## 索引的分类

### 索引分类

| 分类 | 含义 | 特点 | 关键字 |
| -------- | -------- | -------- | ---------- |
| 主键索引 | 针对于表中主键创建的索引 | 默认自动创建, 只能有一个 | PRIMARY |
| 唯一索引 | 避免同一个表中某数据列中的值重复 | 可以有多个 | UNIQUE |
| 常规索引 | 快速定位特定数据 | 可以有多个 |  |
| 全文索引 | 全文索引查找的是文本中的关键词，而不是比较索引中的值 | 可以有多个 | FULLTEXT |

### 聚集索引 & 二级索引

| 分类                      | 含义                                                       | 特点                     |
| :------------------------ | :--------------------------------------------------------- | ------------------------ |
| 聚集索引(Clustered Index) | 将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据 | 必须有,而且只<br/>有一个 |
| 二级索引(Secondary Index) | 将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键 | 可以存在多个             |

#### 聚集索引的选取规则：

- 如果存在主键，主键索引就是聚集索引。

- 如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。

- 如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索

  引。

#### 聚集索引 & 二级索引的区别

<img src="img/index01.jpg" alt="index01"  />

- 聚集索引的叶子节点下挂的是这一行的数据 。
- 二级索引的叶子节点下挂的是该字段值对应的主键值。

#### 执行流程探讨

> 执行`select * from user where name = “Arm”`。
>
> ​	回表查询：
> ​		这种先到二级索引中查找数据，找到主键值，然后再到聚集索引中根据主键值，获取数据的方式，就称之为回表查询。

![index02](img/index02.jpg)

1. 由于是根据 name 字段进行查询，所以先根据`name='Arm'`到 name 字段的二级索引中进行匹配查找。但是在二级索引中只能查找到 Arm 对应的主键值 10。
2. 由于查询返回的数据是 *，所以此时，还需要根据主键值 10，到聚集索引中查找 10 对应的记录(回表查询)，最终找到 10 对应的行 row。
3. 最终拿到这一行的数据，直接返回即可。

## 索引的语法

### 1) 创建索引

```mysql
create [unique | fulltext] index i_name on t_name(index_col_name, ...);
```

### 2) 查看索引

```mysql
show index from t_name;
```

### 3) 删除索引

```mysql
drop index i_name on t_name;
```

